$(document).ready(function(){function i(i){var t=i.offset().top,e=i.offset().left,a={top:t-$(window).scrollTop(),left:e-$(window).scrollLeft()};return a}var t='<div class="pixelarity-img-edit"><canvas class="pixelarity-img-edit-can"> </canvas><canvas class="pixelarity-img-edit-process-can"></canvas><div class="pixelarity-img-edit-select"><div class="pixelarity-img-edit-select-resize"></div></div> <div id="pixelarity-side-opt-holder"> <div class="pixelarity-side-opt pixelarity-active-side-opt" id="pixelarity-side-opt-crop"> Crop </div> <div class="pixelarity-side-opt" id="pixelarity-side-opt-draw"> Draw </div> <div class="pixelarity-side-opt" id="pixelarity-side-opt-filter"> Filters </div> </div>  <div id="pixelarity-filter-opt-cont"><div class="pixelarity-filter-opt pixelarity-active-filter-opt" id="pixelarity-filter-opt-1">None</div><div class="pixelarity-filter-opt" id="pixelarity-filter-opt-2">Grayscale</div><div class="pixelarity-filter-opt" id="pixelarity-filter-opt-3">Chrome</div><div class="pixelarity-filter-opt" id="pixelarity-filter-opt-4">Nova</div><div class="pixelarity-filter-opt" id="pixelarity-filter-opt-5">Blur</div></div>  <div id="pixelarity-draw-opt-color-cont"><div class="pixelarity-draw-opt-color" id="pixelarity-draw-opt-color-1"></div><div class="pixelarity-draw-opt-color" id="pixelarity-draw-opt-color-2"></div><div class="pixelarity-draw-opt-color pixelarity-active-draw-opt-color" id="pixelarity-draw-opt-color-3"></div><div class="pixelarity-draw-opt-color" id="pixelarity-draw-opt-color-4"></div><div class="pixelarity-draw-opt-color" id="pixelarity-draw-opt-color-5"></div><div class="pixelarity-draw-opt-color" id="pixelarity-draw-opt-color-6"></div></div> <div class="pixelarity-img-edit-act pixelarity-img-edit-save"> Done </div><div class="pixelarity-img-edit-act pixelarity-img-edit-cancel"> Cancel </div></div>';$("body").append(t),window.pixelarity={can:$(".pixelarity-img-edit-can")[0],ctx:null,processCan:$(".pixelarity-img-edit-process-can")[0],selectionBox:$(".pixelarity-img-edit-select"),container:$(".pixelarity-img-edit"),saveBtn:$(".pixelarity-img-edit-save"),cancelBtn:$(".pixelarity-img-edit-cancel"),sideOpts:$(".pixelarity-side-opt"),sideOptCrop:$("#pixelarity-side-opt-crop"),sideOptDraw:$("#pixelarity-side-opt-draw"),sideOptFilter:$("#pixelarity-side-opt-filter"),drawOptsColorsContainer:$("#pixelarity-draw-opt-color-cont"),drawOptsColors:$(".pixelarity-draw-opt-color"),drawOptColor1:$("#pixelarity-draw-opt-color-1"),drawOptColor1:$("#pixelarity-draw-opt-color-2"),drawOptColor1:$("#pixelarity-draw-opt-color-3"),drawOptColor1:$("#pixelarity-draw-opt-color-4"),drawOptColor1:$("#pixelarity-draw-opt-color-5"),drawOptColor1:$("#pixelarity-draw-opt-color-6"),filterOptsContainer:$("#pixelarity-filter-opt-cont"),filterOpts:$(".pixelarity-filter-opt"),filterOptNone:$("#pixelarity-filter-opt-1"),filterOptGray:$("#pixelarity-filter-opt-2"),filterOptChrome:$("#pixelarity-filter-opt-3"),filterOptNova:$("#pixelarity-filter-opt-4"),filterOptBlur:$("#pixelarity-filter-opt-5"),drag:!1,resize:!1,square:!0,status:!1,grcx:null,grcy:null,callback:null,imageType:null,imageQuality:1,tool:"crop",drawing:!1,colors:["000000","ffffff","2795f3","ec5454","2ecc71","efd244"],drawColor:"2795f3",open:function(i,t,e,a,l){if(i.constructor!==File||!i.type.match("image.*"))return!1;this.drag=!1,this.resize=!1,this.changeTool("crop"),this.square=t===!0?!0:!1,this.imageQuality=Number(l)>0&&Number(l)<=1?Number(l):1,"jpeg"==a||"png"==a||"gif"==a||"bmp"==a?this.imageType=a:this.imageType="jpeg",this.grcx=!1,this.grcy=!1;var r={};this.callback=e&&"[object Function]"===r.toString.call(e)?e:!1,this.status=!0,this.ctx=this.can.getContext("2d"),pixelarity.container.css("display","block").stop().animate({opacity:"1"});var p=new Image,o=this;return $(p).on("load",function(){p.width>p.height?(o.can.width=p.width,o.can.height=p.height,o.can.style.width=$(window).width()/2*1+"px",o.can.style.height=p.height*($(window).width()/2*1/p.width)+"px",pixelarity.ctx.fillStyle="#fff",pixelarity.ctx.fillRect(0,0,o.can.width,o.can.height),pixelarity.ctx.drawImage(p,0,0,o.can.width,o.can.height),pixelarity.selectionBox.height($(o.can).height()-20),pixelarity.selectionBox.width($(o.can).height()-20),pixelarity.selectionBox.css({left:$(window).width()/2-$(o.can).height()/2+10+"px",top:$(window).height()/2-$(o.can).height()/2-15+"px"})):p.width<p.height?(o.can.width=p.width,o.can.height=p.height,o.can.style.width=p.width*($(window).height()/3*2/p.height)+"px",o.can.style.height=$(window).height()/3*2+"px",pixelarity.ctx.fillStyle="#fff",pixelarity.ctx.fillRect(0,0,o.can.width,o.can.height),pixelarity.ctx.drawImage(p,0,0,o.can.width,o.can.height),pixelarity.selectionBox.height($(o.can).width()-20),pixelarity.selectionBox.width($(o.can).width()-20),pixelarity.selectionBox.css({left:$(window).width()/2-$(o.can).width()/2+10+"px",top:$(window).height()/2-$(o.can).width()/2-15+"px"})):(o.can.width=p.width,o.can.height=p.height,o.can.style.width=$(window).height()/4.8*3.3+"px",o.can.style.height=$(window).height()/4.8*3.3+"px",pixelarity.ctx.fillStyle="#fff",pixelarity.ctx.fillRect(0,0,o.can.width,o.can.height),pixelarity.ctx.drawImage(p,0,0,o.can.width,o.can.height),pixelarity.selectionBox.height($(o.can).width()-20),pixelarity.selectionBox.width($(o.can).width()-20),pixelarity.selectionBox.css({left:$(window).width()/2-$(o.can).width()/2+10+"px",top:$(window).height()/2-$(o.can).width()/2-15+"px"}));var i=pixelarity.can.width/$(pixelarity.can).width(),t=pixelarity.can.height*i,e=pixelarity.can.width*i;pixelarity.processCan.height=t,pixelarity.processCan.width=e;var a=pixelarity.processCan.getContext("2d");a.drawImage(pixelarity.can,0,0,e,t)}),p.src=URL.createObjectURL(i),!0},changeTool:function(i){return"crop"==i?(this.selectionBox.css("display","block"),this.tool="crop",this.sideOpts.removeClass("pixelarity-active-side-opt"),this.sideOptCrop.addClass("pixelarity-active-side-opt"),this.drawOptsColorsContainer.css("display","none"),this.filterOptsContainer.css("display","none"),!0):"draw"==i?(this.tool="draw",this.sideOpts.removeClass("pixelarity-active-side-opt"),this.sideOptDraw.addClass("pixelarity-active-side-opt"),this.selectionBox.css("display","none"),this.filterOptsContainer.css("display","none"),this.drawOptsColorsContainer.css("display","block"),!0):void("filter"==i&&(this.tool="filter",this.sideOpts.removeClass("pixelarity-active-side-opt"),this.sideOptFilter.addClass("pixelarity-active-side-opt"),this.drawOptsColorsContainer.css("display","none"),this.selectionBox.css("display","none"),this.filterOptsContainer.css("display","block")))},changeFilter:function(i){pixelarity.filterOpts.removeClass("pixelarity-active-filter-opt"),$("#pixelarity-filter-opt-"+i).addClass("pixelarity-active-filter-opt"),1==i?pixelarity.ctx.filter="none":2==i?pixelarity.ctx.filter="grayscale(1)":3==i?pixelarity.ctx.filter="sepia(0.42) saturate(1.4) contrast(1.1)":4==i?pixelarity.ctx.filter="grayscale(0.25) saturate(0.75) contrast(1.5)":5==i&&(pixelarity.ctx.filter="blur(14px)"),this.ctx.height=this.ctx.height,this.ctx.drawImage(pixelarity.processCan,0,0,pixelarity.can.width,pixelarity.can.height)},close:function(){this.drag=!1,this.resize=!1,this.square=!0,this.status=!1,this.grcx=void 0,this.grcy=void 0,this.callback=void 0,this.can.height=0,this.can.width=0,this.processCan.height=0,this.processCan.width=0,pixelarity.ctx.filter="none",pixelarity.filterOpts.removeClass("pixelarity-active-filter-opt"),pixelarity.filterOptNone.addClass("pixelarity-active-filter-opt");var i=this.processCan.getContext("2d");pixelarity.ctx.clearRect(0,0,0,0),i.clearRect(0,0,0,0),pixelarity.selectionBox.css({height:"0px",width:"0px"}),pixelarity.container.stop().animate({opacity:"0"},300),setTimeout(function(){pixelarity.container.css({display:"none"})},300)}},$(document).on("mouseup",function(){pixelarity.drag=!1,pixelarity.resize=!1,pixelarity.grcx=!1,pixelarity.grcy=!1,pixelarity.drawing=!1}),pixelarity.selectionBox.on("mousedown",function(t){var e=$(this),a=t.clientX-i(e).left,l=t.clientY-i(e).top;pixelarity.grcx=!1,pixelarity.grcy=!1,pixelarity.selectionBox.width()-a<=28&&pixelarity.selectionBox.height()-l<=28?(pixelarity.drag=!1,pixelarity.resize=!0):(pixelarity.drag=!0,pixelarity.resize=!1)}),$(pixelarity.can).on("mousedown",function(t){if("draw"==pixelarity.tool){pixelarity.drawing=!0;var e=pixelarity.can.width/$(pixelarity.can).width();pixelarity.lastDrawX=(t.clientX-i($(pixelarity.can)).left)*e,pixelarity.lastDrawY=(t.clientY-i($(pixelarity.can)).top)*e}}),$(document).on("mousemove",function(t){var e=t.clientX-i(pixelarity.selectionBox).left,a=t.clientY-i(pixelarity.selectionBox).top;if(pixelarity.drag===!0&&pixelarity.status){pixelarity.grcx===!1&&(pixelarity.grcx=e),pixelarity.grcy===!1&&(pixelarity.grcy=a);var l=t.clientX-pixelarity.grcx,r=t.clientY-pixelarity.grcy;l+pixelarity.selectionBox.width()>=$(pixelarity.can).width()+i($(pixelarity.can)).left||l<=i($(pixelarity.can)).left?l<=i($(pixelarity.can)).left?pixelarity.selectionBox.css({left:i($(pixelarity.can)).left+"px"}):pixelarity.selectionBox.css({left:i($(pixelarity.can)).left+$(pixelarity.can).width()-pixelarity.selectionBox.width()+"px"}):pixelarity.selectionBox.css({left:l+"px"}),r+pixelarity.selectionBox.height()>=$(pixelarity.can).height()+i($(pixelarity.can)).top||r<=i($(pixelarity.can)).top?r<=i($(pixelarity.can)).top?pixelarity.selectionBox.css({top:i($(pixelarity.can)).top+"px"}):pixelarity.selectionBox.css({top:i($(pixelarity.can)).top+$(pixelarity.can).height()-pixelarity.selectionBox.height()+"px"}):pixelarity.selectionBox.css({top:r+"px"})}else if(pixelarity.resize===!0&&pixelarity.status){var p=e,o=a;pixelarity.square?(p>=o?(o=p,100>p&&(p=100,o=100)):(p=o,100>o&&(p=100,o=100)),p+i(pixelarity.selectionBox).left>=$(pixelarity.can).width()+i($(pixelarity.can)).left?(p=i($(pixelarity.can)).left+$(pixelarity.can).width()-i(pixelarity.selectionBox).left,i(pixelarity.selectionBox).top+p>$(pixelarity.can).height()+i($(pixelarity.can)).top&&(p=i($(pixelarity.can)).top+$(pixelarity.can).height()-i(pixelarity.selectionBox).top),o=p):o+i(pixelarity.selectionBox).top>=$(pixelarity.can).height()+i($(pixelarity.can)).top&&(o=i($(pixelarity.can)).top+$(pixelarity.can).height()-i(pixelarity.selectionBox).top,i(pixelarity.selectionBox).left+o>$(pixelarity.can).width()+i($(pixelarity.can)).left&&(o=i($(pixelarity.can)).left+$(pixelarity.can).width()-i(pixelarity.selectionBox).left),p=o)):(100>=p&&(p=100),100>=o&&(o=100),t.clientX>=$(pixelarity.can).width()+i($(pixelarity.can)).left&&(p=i($(pixelarity.can)).left+$(pixelarity.can).width()-i(pixelarity.selectionBox).left),t.clientY>=$(pixelarity.can).height()+i($(pixelarity.can)).top&&(o=i($(pixelarity.can)).top+$(pixelarity.can).height()-i(pixelarity.selectionBox).top)),pixelarity.selectionBox.css({width:p+"px",height:o+"px"})}else if(pixelarity.drawing&&pixelarity.status){var c=pixelarity.can.width/$(pixelarity.can).width(),s=(t.clientX-i($(pixelarity.can)).left)*c,x=(t.clientY-i($(pixelarity.can)).top)*c,n=21;pixelarity.ctx.fillStyle="#"+pixelarity.drawColor;var y=pixelarity.processCan.getContext("2d");y.fillStyle="#"+pixelarity.drawColor;for(var l=(s-pixelarity.lastDrawX)/n,r=(x-pixelarity.lastDrawY)/n,d=1;n>=d;d++)pixelarity.ctx.beginPath(),pixelarity.ctx.arc(s-l*d,x-r*d,3*c,0,2*Math.PI,!1),pixelarity.ctx.fill(),y.beginPath(),y.arc((s-l*d)*c,(x-r*d)*c,c*c*3,0,2*Math.PI,!1),y.fill();pixelarity.lastDrawX=s,pixelarity.lastDrawY=x}}),pixelarity.saveBtn.on("click",function(){if(!pixelarity.callback)return void pixelarity.close();"crop"!=pixelarity.tool&&pixelarity.changeTool("crop");var t=pixelarity.can.width/$(pixelarity.can).width(),e=pixelarity.selectionBox.height()*t,a=pixelarity.selectionBox.width()*t,l=(i(pixelarity.selectionBox).left-i($(pixelarity.can)).left)*t,r=(i(pixelarity.selectionBox).top-i($(pixelarity.can)).top)*t;pixelarity.processCan.height=e,pixelarity.processCan.width=a;var p=pixelarity.processCan.getContext("2d");p.drawImage(pixelarity.can,l,r,a,e,0,0,a,e),pixelarity.callback(pixelarity.processCan.toDataURL("image/"+pixelarity.imageType,pixelarity.imageQuality)),pixelarity.close()}),pixelarity.cancelBtn.on("click",function(){pixelarity.close()}),pixelarity.sideOpts.click(function(){var i=$(this).attr("id").substr(20);pixelarity.changeTool(i)}),$(window).on("resize",function(){pixelarity.status&&pixelarity.selectionBox.css({left:$(window).width()/2-$(pixelarity.can).height()/2+10+"px",top:$(window).height()/2-$(pixelarity.can).height()/2+10+"px"})}),pixelarity.drawOptsColors.on("click",function(){var i=Number($(this).attr("id").substr(26))-1;pixelarity.drawColor=pixelarity.colors[i],pixelarity.drawOptsColors.removeClass("pixelarity-active-draw-opt-color"),$(this).addClass("pixelarity-active-draw-opt-color")}),pixelarity.filterOpts.on("click",function(){var i=Number($(this).attr("id").substr(22));pixelarity.changeFilter(i)})});